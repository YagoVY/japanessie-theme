{% comment %}
  Japanessie Custom Header Section
  Professional header with search, logo, and CTA button
{% endcomment %}

<style>
  .japanessie-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    z-index: 1000;
    transition: opacity 0.3s ease;
  }

  .japanessie-header.scrolled {
    opacity: 0.95;
  }

  .header-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 70px;
  }

  .header-logo {
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    color: #c53030;
    font-weight: 700;
    font-size: 24px;
    transition: transform 0.2s ease;
  }

  .header-logo:hover {
    transform: scale(1.05);
  }

  .logo-icon {
    width: 32px;
    height: 32px;
    fill: #c53030;
  }

  .header-search {
    flex: 1;
    max-width: 500px;
    margin: 0 40px;
    position: relative;
  }

  .search-form {
    position: relative;
    width: 100%;
  }

  .search-input {
    width: 100%;
    padding: 12px 50px 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 25px;
    font-size: 16px;
    background: #fff;
    transition: all 0.3s ease;
  }

  .search-input:focus {
    outline: none;
    border-color: #c53030;
    box-shadow: 0 0 0 3px rgba(197, 48, 48, 0.1);
  }

  .search-button {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: #c53030;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .search-button:hover {
    background: #a02626;
  }

  .search-icon {
    width: 18px;
    height: 18px;
    fill: white;
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .cta-button {
    background: linear-gradient(135deg, #c53030, #fd7e14);
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 25px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .cta-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(197, 48, 48, 0.3);
  }

  .cart-icon {
    position: relative;
    cursor: pointer;
    padding: 8px;
  }

  .cart-icon svg {
    width: 24px;
    height: 24px;
    fill: #374151;
    transition: fill 0.2s ease;
  }

  .cart-icon:hover svg {
    fill: #c53030;
  }

  .cart-count {
    position: absolute;
    top: 0;
    right: 0;
    background: #c53030;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 600;
  }

  .mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  .hamburger {
    width: 24px;
    height: 24px;
    fill: #374151;
    transition: fill 0.2s ease;
  }

  .mobile-menu-toggle:hover .hamburger {
    fill: #c53030;
  }

  .mobile-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 20px;
    transform: translateY(-100%);
    opacity: 0;
    transition: all 0.3s ease;
  }

  .mobile-menu.active {
    transform: translateY(0);
    opacity: 1;
  }

  .mobile-search {
    margin-bottom: 20px;
  }

  .mobile-search .search-input {
    font-size: 16px;
    padding: 12px 16px;
    border-radius: 8px;
  }

  .mobile-nav {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .mobile-nav a {
    color: #374151;
    text-decoration: none;
    font-weight: 500;
    padding: 8px 0;
    border-bottom: 1px solid #e2e8f0;
  }

  .mobile-nav a:hover {
    color: #c53030;
  }

  /* Mobile Styles */
  @media (max-width: 768px) {
    .header-container {
      padding: 0 16px;
      height: 60px;
    }

    .header-logo {
      font-size: 20px;
    }

    .logo-icon {
      width: 28px;
      height: 28px;
    }

    .header-search {
      display: none;
    }

    .mobile-menu-toggle {
      display: block;
    }

    .header-actions {
      gap: 12px;
    }

    .cta-button {
      padding: 10px 16px;
      font-size: 14px;
    }

    .mobile-menu {
      display: block;
    }
  }

  /* Tablet Styles */
  @media (max-width: 1024px) and (min-width: 769px) {
    .header-search {
      margin: 0 20px;
      max-width: 400px;
    }
  }

  /* Scroll behavior */
  .header-spacer {
    height: 70px;
  }

  @media (max-width: 768px) {
    .header-spacer {
      height: 60px;
    }
  }
</style>

<header class="japanessie-header" id="japanessie-header">
  <div class="header-container">
    <!-- Logo -->
    <a href="{{ routes.root_url }}" class="header-logo" aria-label="Japanessie Home">
      <svg class="logo-icon" viewBox="0 0 32 32" aria-hidden="true">
        <path d="M16 4c6.627 0 12 5.373 12 12s-5.373 12-12 12S4 22.627 4 16 9.373 4 16 4zm0 2C10.477 6 6 10.477 6 16s4.477 10 10 10 10-4.477 10-10S21.523 6 16 6zm-1 6v8h2v-8h-2zm0 10v2h2v-2h-2z"/>
        <circle cx="16" cy="8" r="2" fill="#c53030"/>
        <path d="M12 20c0-2 1-3 3-3s3 1 3 3v2h-6v-2z" fill="#fd7e14"/>
      </svg>
      <span>Japanessie</span>
    </a>

    <!-- Desktop Search -->
    <div class="header-search">
      <form class="search-form" action="{{ routes.search_url }}" method="get" role="search">
        <input 
          type="search" 
          name="q" 
          class="search-input" 
          placeholder="{{ section.settings.search_placeholder | default: 'Search products or enter your name...' }}"
          value="{{ search.terms | escape }}"
          aria-label="Search products"
          autocomplete="off"
        >
        <button type="submit" class="search-button" aria-label="Search">
          <svg class="search-icon" viewBox="0 0 24 24">
            <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </button>
      </form>
    </div>

    <!-- Desktop Actions -->
    <div class="header-actions">
      {% if section.settings.show_cart %}
        <a href="{{ routes.cart_url }}" class="cart-icon" aria-label="Shopping cart">
          <svg viewBox="0 0 24 24">
            <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 11-4 0v-6m4 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4"/>
          </svg>
          {% if cart.item_count > 0 %}
            <span class="cart-count" aria-label="{{ cart.item_count }} items in cart">{{ cart.item_count }}</span>
          {% endif %}
        </a>
      {% endif %}

      <a href="{{ section.settings.cta_url | default: '#' }}" class="cta-button" onclick="trackCTA('header-cta')">
        {{ section.settings.cta_text | default: 'Create Now' }}
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M13 7l5 5m0 0l-5 5m5-5H6"/>
        </svg>
      </a>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle menu">
        <svg class="hamburger" viewBox="0 0 24 24">
          <path d="M3 12h18m-9-9v18"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobile-menu">
    <div class="mobile-search">
      <form action="{{ routes.search_url }}" method="get" role="search">
        <input 
          type="search" 
          name="q" 
          class="search-input" 
          placeholder="{{ section.settings.search_placeholder | default: 'Search products or enter your name...' }}"
          value="{{ search.terms | escape }}"
          aria-label="Search products"
          autocomplete="off"
        >
      </form>
    </div>

    <nav class="mobile-nav" role="navigation">
      {% for block in section.blocks %}
        {% if block.type == 'navigation_item' %}
          <a href="{{ block.settings.url }}" onclick="trackNavigation('mobile-nav-{{ forloop.index }}')">
            {{ block.settings.title }}
          </a>
        {% endif %}
      {% endfor %}
      
      {% if section.settings.show_cart %}
        <a href="{{ routes.cart_url }}" onclick="trackNavigation('mobile-cart')">
          Cart {% if cart.item_count > 0 %}({{ cart.item_count }}){% endif %}
        </a>
      {% endif %}
    </nav>
  </div>
</header>

<div class="header-spacer"></div>

<script>
  // Mobile menu functionality
  function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const header = document.getElementById('japanessie-header');
    
    menu.classList.toggle('active');
    header.classList.toggle('menu-open');
    
    // Track menu toggle
    if (typeof gtag !== 'undefined') {
      gtag('event', 'mobile_menu_toggle', {
        event_category: 'navigation',
        event_label: menu.classList.contains('active') ? 'open' : 'close'
      });
    }
  }

  // Scroll behavior
  let lastScrollTop = 0;
  window.addEventListener('scroll', function() {
    const header = document.getElementById('japanessie-header');
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    
    if (scrollTop > 100) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }
    
    lastScrollTop = scrollTop;
  });

  // Analytics tracking
  function trackCTA(label) {
    if (typeof gtag !== 'undefined') {
      gtag('event', 'cta_click', {
        event_category: 'engagement',
        event_label: label
      });
    }
  }

  function trackNavigation(label) {
    if (typeof gtag !== 'undefined') {
      gtag('event', 'navigation_click', {
        event_category: 'navigation',
        event_label: label
      });
    }
  }

  // Search analytics
  document.addEventListener('DOMContentLoaded', function() {
    const searchForms = document.querySelectorAll('.search-form');
    searchForms.forEach(form => {
      form.addEventListener('submit', function(e) {
        const query = this.querySelector('input[name="q"]').value;
        if (typeof gtag !== 'undefined' && query.trim()) {
          gtag('event', 'search', {
            event_category: 'engagement',
            event_label: query,
            search_term: query
          });
        }
      });
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', function(e) {
      const menu = document.getElementById('mobile-menu');
      const toggle = document.querySelector('.mobile-menu-toggle');
      
      if (!menu.contains(e.target) && !toggle.contains(e.target)) {
        menu.classList.remove('active');
      }
    });
  });
</script>

{% schema %}
{
  "name": "Japanessie Custom Header",
  "settings": [
    {
      "type": "header",
      "content": "Logo Settings"
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "Logo Text",
      "default": "Japanessie"
    },
    {
      "type": "header",
      "content": "Search Settings"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search Placeholder",
      "default": "Search products or enter your name..."
    },
    {
      "type": "header",
      "content": "CTA Button"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "Create Now"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "CTA Button URL",
      "default": "/pages/customize"
    },
    {
      "type": "header",
      "content": "Cart Settings"
    },
    {
      "type": "checkbox",
      "id": "show_cart",
      "label": "Show Cart Icon",
      "default": true
    },
    {
      "type": "header",
      "content": "Header Behavior"
    },
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "Enable Sticky Header",
      "default": true
    },
    {
      "type": "range",
      "id": "header_opacity",
      "label": "Header Background Opacity",
      "min": 0.8,
      "max": 1,
      "step": 0.05,
      "default": 0.98
    }
  ],
  "blocks": [
    {
      "type": "navigation_item",
      "name": "Navigation Item",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Link Text",
          "default": "Link"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Japanessie Custom Header",
      "blocks": [
        {
          "type": "navigation_item",
          "settings": {
            "title": "Shop",
            "url": "/collections/all"
          }
        },
        {
          "type": "navigation_item",
          "settings": {
            "title": "About",
            "url": "/pages/about"
          }
        },
        {
          "type": "navigation_item",
          "settings": {
            "title": "Contact",
            "url": "/pages/contact"
          }
        }
      ]
    }
  ]
}
{% endschema %}
